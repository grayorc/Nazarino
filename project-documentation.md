# مستندات پروژه نظرینو

## فصل اول: تعریف مسأله

### 1.1 مقدمه
سیستم نظرینو یک پلتفرم جامع برای ایجاد و مدیریت نظرسنجی‌ها و انتخابات آنلاین است. این سیستم با هدف تسهیل فرآیند جمع‌آوری نظرات، رأی‌گیری و تحلیل داده‌ها طراحی شده است. کاربران می‌توانند نظرسنجی‌های خود را ایجاد کنند، گزینه‌های مختلف را تعریف کنند، و نتایج را به صورت آنی مشاهده نمایند.

### 1.2 اهداف پروژه
- ایجاد بستری امن و قابل اعتماد برای برگزاری نظرسنجی‌ها و انتخابات آنلاین
- ارائه امکانات پیشرفته مدیریت کاربران با سطوح دسترسی مختلف
- پشتیبانی از سیستم اشتراک و پرداخت برای دسترسی به امکانات ویژه
- ارائه تحلیل‌های آماری و گزارش‌های مدیریتی از نتایج نظرسنجی‌ها
- امکان صادرات داده‌ها در قالب‌های مختلف از جمله Excel
- پشتیبانی کامل از زبان فارسی و قالب RTL

### 1.3 فرضیه‌ها
1. امنیت و اعتماد: فرض می‌شود که ایجاد یک سیستم امن با قابلیت احراز هویت دقیق کاربران می‌تواند اعتماد شرکت‌کنندگان را جلب کرده و میزان مشارکت در نظرسنجی‌ها را افزایش دهد.

2. دسترسی آنلاین: فرض می‌شود که امکان دسترسی به سیستم نظرسنجی در هر زمان و مکان می‌تواند تعداد شرکت‌کنندگان را افزایش داده و محدودیت‌های زمانی و مکانی روش‌های سنتی را برطرف کند.

3. تحلیل داده: فرض می‌شود که ارائه ابزارهای تحلیل آماری و نمودارهای گرافیکی می‌تواند به مدیران سیستم کمک کند تا بینش عمیق‌تری نسبت به نتایج نظرسنجی‌ها به دست آورند و تصمیمات بهتری اتخاذ کنند.

### 1.4 تاریخچه
تاریخچه سیستم‌های نظرسنجی به دهه 1930 و 1940 برمی‌گردد، زمانی که جورج گالوپ مؤسسه آمریکایی افکار عمومی (American Institute of Public Opinion) را تأسیس کرد و اولین نظرسنجی‌های رسمی و علمی را انجام داد [^1]. در آن زمان، نظرسنجی‌ها به صورت کاملاً دستی و با استفاده از فرم‌های کاغذی انجام می‌شدند.

جورج هاوس گالوپ در 27 دسامبر 1935 مؤسسه استخراج عمومی را بنیاد نهاد که به نام خود وی گالوپ خوانده می‌شود. مخارج این مؤسسه از حق اشتراک مؤسسات تبلیغاتی و تولیدی در ایالات متحده آمریکا تأمین می‌شود. بسیاری از کشورهای جهان در موارد گوناگون، جهت اطلاع از افکار عمومی به این مؤسسه مراجعه می‌کنند [^2].

گالوپ با استفاده از روش‌های آماری دقیق و نمونه‌گیری جمعیتی، توانست دقت نظرسنجی‌ها را به طور قابل توجهی افزایش دهد. نظرسنجان موسسه گالوپ و سایر سازمان‌های معتبر نظرسنجی از نمونه‌های آماری با هزار تا هزار و ۵۰۰ عضو استفاده می‌کنند، زیرا این تعداد در مقابل هزینه اقتصادی روبه رشد استفاده از نمونه‌های بزرگتر همواره مناسب است [^3].

با پیشرفت فناوری و ظهور کامپیوترها در دهه 1970، روش‌های جمع‌آوری و تحلیل داده‌ها نیز متحول شدند. در این دوره، سیستم‌های CASIC (Computer-Assisted Survey Information Collection) به وجود آمدند که امکان جمع‌آوری و پردازش سریع‌تر داده‌ها را فراهم می‌کردند. سازمان نظرسنجی گالوپ بیشتر مصاحبه‌های خود را از طریق تلفن و توسط شعب مستقر در مناطق مختلف سراسر ایالات متحده انجام می‌دهد. مصاحبه‌گرهای آموزش دیده این سازمان برای انجام مصاحبه‌ها از فن آوری رایانه‌ای در انجام مصاحبه‌های تلفنی بهره می‌گیرند [^4].

سیستم‌های نظرسنجی آنلاین از اوایل دهه 2000 میلادی با گسترش اینترنت محبوبیت یافتند و به تدریج جایگزین روش‌های سنتی شدند. این سیستم‌ها مزایای متعددی نسبت به روش‌های قبلی داشتند، از جمله: هزینه کمتر، طراحی آسان‌تر، جمع‌آوری و پردازش سریع‌تر داده‌ها، امکان استفاده از منطق پرش (skip logic)، و قابلیت پاسخگویی با هر دستگاهی [^5].

امروزه، با استفاده از فناوری‌های نوین وب و موبایل، سیستم‌های نظرسنجی آنلاین مانند نظرینو می‌توانند تجربه کاربری بهتری را ارائه دهند و با قابلیت‌های پیشرفته تحلیل داده، نتایج دقیق‌تری را در اختیار کاربران قرار دهند.

[^1]: "How One Man Used Opinion Polling to Change American Politics", Time Magazine, https://time.com/4568359/george-gallup-polling-history/
[^2]: "آشنایی با موسسه نظرسنجی گالوپ", همشهری آنلاین, https://www.hamshahrionline.ir/news/200804/آشنایی-با-موسسه-نظرسنجی-گالوپ
[^3]: "معرفی موسسه نظرسنجی گالوپ", ویستا, https://vista.ir/w/a/16/92vpv/معرفی-موسسه-نظرسنجی-گالوپ
[^4]: "آشنایی با موسسه نظرسنجی گالوپ", همشهری آنلاین, https://www.hamshahrionline.ir/news/200804/آشنایی-با-موسسه-نظرسنجی-گالوپ
[^5]: "The History of Survey Platforms & Technology", Pollfish Resources, https://resources.pollfish.com/market-research/online-survey-platforms-history/

### 1.5 مشکلات موجود
سیستم نظرینو با هدف حل مشکلات موجود در سیستم‌های نظرسنجی سنتی و آنلاین طراحی شده است. این مشکلات شامل:
- پیچیدگی‌های برگزاری نظرسنجی‌های آنلاین با تعداد شرکت‌کنندگان بالا
- چالش‌های امنیتی در سیستم‌های رأی‌گیری آنلاین
- نیاز به تحلیل داده‌های نظرسنجی به صورت کارآمد و قابل فهم
- مدیریت سطوح دسترسی کاربران به بخش‌های مختلف سیستم
- نیاز به پشتیبانی از زبان فارسی و قالب RTL در گزارش‌ها و خروجی‌ها

### 1.6 راه‌حل پیشنهادی
سیستم نظرینو با استفاده از فریم‌ورک Laravel طراحی شده است و راه‌حل‌های زیر را ارائه می‌دهد:
- سیستم کاربری پیشرفته با مدیریت نقش‌ها و دسترسی‌ها
- امکان ایجاد نظرسنجی‌های عمومی و خصوصی
- سیستم اشتراک با سطوح مختلف و قابلیت‌های متفاوت
- داشبورد مدیریتی برای کنترل تمام جنبه‌های سیستم
- امکان صادرات داده‌ها در قالب Excel با پشتیبانی کامل از زبان فارسی
- تحلیل هوشمند نتایج نظرسنجی‌ها

## فصل دوم: تجزیه و تحلیل سیستم

### 2.1 تحلیل پروژه
در دنیای نظرسنجی و سیستم‌های رأی‌گیری آنلاین، ایجاد یک تجربه کاربری جذاب و معنادار برای کاربران نیازمند طراحی دقیق و هوشمندانه‌ای از نقش‌ها و موجودیت‌ها در سیستم است. هر سیستم نظرسنجی به عنوان یک سیستم پیچیده، شامل مجموعه‌ای از عناصر و تعاملات است که به طور همزمان در حال کارکردن هستند. این عناصر شامل کاربران، مدیران، نظرسنجی‌ها، گزینه‌ها، و محیط‌های کاربری می‌شوند که هر یک نقش خاصی را در جریان داده‌ها ایفا می‌کنند.

نقش‌ها به وظایف و مسئولیت‌های مختلف اشاره دارند که هر یک از آنها در شکل‌دهی به تجربه کاربری تأثیرگذار هستند. به عنوان مثال، کاربر عادی به عنوان اصلی‌ترین نقش، با محیط و موجودیت‌ها تعامل دارد و در نظرسنجی‌ها شرکت می‌کند. در کنار آن، کاربران ویژه به عنوان ایجادکنندگان نظرسنجی‌ها عمل می‌کنند و مدیران سیستم به مدیریت کلی پلتفرم می‌پردازند.

از سوی دیگر، موجودیت‌ها به اشیاء و عناصری در سیستم اشاره دارند که می‌توانند ویژگی‌ها و رفتارهای خاصی داشته باشند. این موجودیت‌ها شامل نظرسنجی‌ها، گزینه‌ها، نتایج، و گزارش‌ها هستند که هر یک به نوعی بر روی جریان سیستم تأثیر می‌گذارند. مدیریت صحیح این موجودیت‌ها و نحوه تعامل آنها با یکدیگر، برای ایجاد یک تجربه کاربری روان و جذاب ضروری است.

جریان داده‌ها، به عنوان یک عنصر کلیدی در سیستم، به نحوه انتقال و پردازش اطلاعات بین نقش‌ها و موجودیت‌ها اشاره دارد. این شامل ورودی‌های کاربران، خروجی‌های سیستم و مدیریت وضعیت موجودیت‌ها می‌شود. درک دقیق این جریان داده‌ها به توسعه‌دهندگان این امکان را می‌دهد که تعاملات معناداری را طراحی کنند و به کاربران تجربه‌ای لذت‌بخش و کارآمد ارائه دهند.

در ادامه، به بررسی دقیق‌تر نقش‌ها و موجودیت‌ها در جریان داده‌های سیستم نظرینو خواهیم پرداخت و نحوه تأثیرگذاری آنها بر روی تجربه کاربری را تحلیل خواهیم کرد. این بررسی می‌تواند به درک بهتر فرآیندهای سیستم و بهبود کیفیت خدمات ارائه شده کمک کند.

#### جدول نقش‌ها و موجودیت‌های سیستم نظرینو

| ردیف | نقش / موجودیت | شرح |
|:---:|:---:|:---:|
| ۱ | کاربر عادی (User) | کاربری که در سیستم ثبت‌نام می‌کند، در نظرسنجی‌ها شرکت می‌کند و آرای خود را ثبت می‌نماید. |
| ۲ | کاربر ویژه (Premium User) | کاربری که با پرداخت حق اشتراک، امکان ایجاد و مدیریت نظرسنجی‌ها را دارد. |
| ۳ | نظرسنجی (Poll) | موجودیتی که شامل عنوان، توضیحات، گزینه‌ها و تنظیمات مربوط به یک نظرسنجی است. |
| ۴ | تراکنش (Transaction) | سوابق مالی کاربران شامل پرداخت حق اشتراک و هزینه‌های مربوطه. |
| ۵ | سیستم (System) | مدیریت تمام عملیات سیستم از جمله احراز هویت، ثبت آرا، محاسبه نتایج و مدیریت دسترسی‌ها. |
| ۶ | بانک داده‌ها (Database) | ذخیره اطلاعات کاربران، نظرسنجی‌ها، آرا و تراکنش‌ها. |

#### نقش‌ها در جریان داده‌ها

1. کاربر عادی: داده‌های مربوط به رأی، اطلاعات شخصی و پاسخ‌های نظرسنجی را به سیستم ارسال می‌کند.
2. کاربر ویژه: داده‌های مربوط به ایجاد نظرسنجی، تنظیمات و گزینه‌های نظرسنجی را به سیستم ارسال می‌کند.
3. سیستم نظرینو: تمامی داده‌ها را پردازش کرده و اطلاعات نظرسنجی‌ها را به بانک داده‌ها یا کاربران بازمی‌گرداند.
4. بانک داده‌ها: ذخیره و بازیابی اطلاعات لازم برای پایداری سیستم.

#### تعاملات کلیدی

1. کاربر عادی ↔ سیستم نظرینو: ارسال ورودی‌های کاربری مانند رأی‌ها یا پاسخ‌های نظرسنجی.
2. کاربر ویژه ↔ سیستم نظرینو: ارسال اطلاعات ایجاد و مدیریت نظرسنجی‌ها.
3. سیستم نظرینو ↔ بانک داده‌ها: ذخیره و دریافت اطلاعات نظرسنجی‌ها، کاربران و آرا.
4. کاربر ویژه ↔ بانک داده‌ها: دسترسی به اطلاعات ذخیره‌شده مانند نتایج نظرسنجی‌ها یا تراکنش‌ها.
5. کاربر عادی ↔ بانک داده‌ها: دسترسی به اطلاعات شخصی و سوابق شرکت در نظرسنجی‌ها.

### 2.2 نمودار زمینه (Context Diagram)

سیستم نظرینو با موجودیت‌های زیر در ارتباط است:
- کاربران عادی: استفاده از سیستم برای شرکت در نظرسنجی‌ها
- کاربران ویژه: ایجاد و مدیریت نظرسنجی‌ها
- مدیران سیستم: مدیریت کاربران، نقش‌ها و تنظیمات سیستم
- سیستم پرداخت: پردازش پرداخت‌های مربوط به اشتراک‌ها
- سیستم تحلیل هوش مصنوعی: تحلیل نتایج نظرسنجی‌ها

### 2.3 نمودار جریان داده (DFD)

#### سطح 0 (نمای کلی)
- فرآیند 1: مدیریت کاربران
- فرآیند 2: مدیریت نظرسنجی‌ها
- فرآیند 3: مدیریت اشتراک‌ها
- فرآیند 4: تحلیل و گزارش‌گیری
- فرآیند 5: مدیریت نقش‌ها و دسترسی‌ها

#### نمودار DFD سطح یک
نمودار DFD سطح 1 سیستم نظرینو را به فرآیندهای اصلی زیر تقسیم می‌کند:

1. مدیریت نظرسنجی‌ها:
   - ورودی‌ها: اطلاعات نظرسنجی‌ها (عنوان، توضیحات، گزینه‌ها)، آرای کاربران، تنظیمات نظرسنجی.
   - خروجی‌ها: نمایش نتایج نظرسنجی، گزارش‌های آماری، اعلام وضعیت نظرسنجی.

2. مدیریت کاربران:
   - ورودی‌ها: اطلاعات ثبت‌نام، اطلاعات ورود، درخواست‌های تغییر پروفایل.
   - خروجی‌ها: تأیید ثبت‌نام، احراز هویت، مدیریت سطوح دسترسی.

3. مدیریت تراکنش‌ها:
   - ورودی‌ها: درخواست‌های خرید اشتراک، اطلاعات پرداخت.
   - خروجی‌ها: تأیید پرداخت، ارتقاء سطح کاربری، صدور فاکتور.

4. تحلیل و گزارش‌گیری:
   - ورودی‌ها: داده‌های نظرسنجی‌ها، درخواست‌های گزارش.
   - خروجی‌ها: نمودارهای تحلیلی، گزارش‌های آماری، خروجی Excel.

5. ذخیره اطلاعات:
   - اطلاعات کاربران، نظرسنجی‌ها، آرا و تراکنش‌ها در پایگاه داده ذخیره و در صورت نیاز بازیابی می‌شود.

#### سطح 1 (جزئیات فرآیند مدیریت نظرسنجی‌ها)
- فرآیند 2.1: ایجاد نظرسنجی
- فرآیند 2.2: مدیریت گزینه‌ها
- فرآیند 2.3: ثبت رأی
- فرآیند 2.4: مدیریت نظرات
- فرآیند 2.5: صادرات داده‌ها

### 2.4 نمودار ارتباط موجودیت‌ها (ERD)

#### موجودیت‌های اصلی
- User: اطلاعات کاربران سیستم
- Role: نقش‌های تعریف شده در سیستم
- Permission: دسترسی‌های تعریف شده در سیستم
- Election: اطلاعات نظرسنجی‌ها
- Option: گزینه‌های هر نظرسنجی
- Vote: آرای ثبت شده
- Comment: نظرات ثبت شده
- SubscriptionTier: سطوح اشتراک
- SubFeature: ویژگی‌های هر سطح اشتراک
- SubscriptionUser: اشتراک‌های کاربران
- Follower: روابط دنبال‌کننده/دنبال‌شونده
- AiAnalysis: تحلیل‌های هوشمند نظرسنجی‌ها

#### روابط کلیدی
- هر کاربر می‌تواند چندین نقش داشته باشد (رابطه چند به چند)
- هر نقش می‌تواند چندین دسترسی داشته باشد (رابطه چند به چند)
- هر کاربر می‌تواند چندین نظرسنجی ایجاد کند (رابطه یک به چند)
- هر نظرسنجی می‌تواند چندین گزینه داشته باشد (رابطه یک به چند)
- هر کاربر می‌تواند به گزینه‌های مختلف رأی دهد (رابطه چند به چند)
- هر کاربر می‌تواند چندین نظر ثبت کند (رابطه یک به چند)
- هر کاربر می‌تواند یک اشتراک داشته باشد (رابطه یک به یک)
- هر سطح اشتراک می‌تواند چندین ویژگی داشته باشد (رابطه چند به چند)

### 2.5 توصیف داده‌ها (Data Dictionary)

#### جدول Users
- id: شناسه یکتای کاربر (کلید اصلی)
- username: نام کاربری (یکتا)
- first_name: نام
- last_name: نام خانوادگی
- email: آدرس ایمیل (یکتا)
- email_verified_at: تاریخ تأیید ایمیل
- password: رمز عبور (هش شده)
- phone_number: شماره تلفن
- created_at: تاریخ ایجاد
- updated_at: تاریخ بروزرسانی

#### جدول Elections
- id: شناسه یکتای نظرسنجی (کلید اصلی)
- user_id: شناسه کاربر ایجاد کننده (کلید خارجی)
- title: عنوان نظرسنجی
- description: توضیحات نظرسنجی
- is_public: وضعیت عمومی/خصوصی بودن
- is_open: وضعیت باز/بسته بودن
- end_date: تاریخ پایان
- created_at: تاریخ ایجاد
- updated_at: تاریخ بروزرسانی

#### جدول Options
- id: شناسه یکتای گزینه (کلید اصلی)
- election_id: شناسه نظرسنجی (کلید خارجی)
- title: عنوان گزینه
- description: توضیحات گزینه
- created_at: تاریخ ایجاد
- updated_at: تاریخ بروزرسانی

#### جدول Votes
- id: شناسه یکتای رأی (کلید اصلی)
- user_id: شناسه کاربر رأی دهنده (کلید خارجی)
- option_id: شناسه گزینه (کلید خارجی)
- vote: مقدار رأی (1 یا -1)
- created_at: تاریخ ایجاد
- updated_at: تاریخ بروزرسانی

## فصل سوم: پیاده‌سازی سیستم

### 3.1 معماری سیستم
سیستم نظرینو بر اساس معماری MVC (Model-View-Controller) پیاده‌سازی شده است و از فریم‌ورک Laravel استفاده می‌کند. این معماری باعث جداسازی منطق برنامه از لایه نمایش و دسترسی به داده‌ها می‌شود و توسعه و نگهداری سیستم را آسان‌تر می‌کند.

#### لایه‌های اصلی سیستم
- **مدل‌ها (Models)**: تعریف ساختار داده‌ها و روابط بین آن‌ها
- **نماها (Views)**: رابط کاربری سیستم
- **کنترلرها (Controllers)**: منطق اصلی برنامه و پردازش درخواست‌ها
- **روت‌ها (Routes)**: تعریف مسیرهای دسترسی به سیستم
- **میدل‌ویرها (Middlewares)**: کنترل دسترسی و پردازش درخواست‌ها قبل از رسیدن به کنترلرها

### 3.2 پیاده‌سازی مدل‌ها

#### مدل User
```php
// app/Models/User.php
class User extends Authenticatable
{
    // تعریف روابط با سایر مدل‌ها
    public function roles()
    {
        return $this->belongsToMany(Role::class);
    }
    
    public function elections()
    {
        return $this->hasMany(Election::class);
    }
    
    public function subscriptions()
    {
        return $this->hasMany(SubscriptionUser::class);
    }
    
    // متدهای کمکی
    public function hasRole($role)
    {
        return $this->roles->contains('name', $role);
    }
    
    public function hasActiveSubscriptionTier()
    {
        // بررسی وضعیت اشتراک کاربر
    }
}
```

#### مدل Election
```php
// app/Models/Election.php
class Election extends Model
{
    // تعریف روابط با سایر مدل‌ها
    public function user()
    {
        return $this->belongsTo(User::class);
    }
    
    public function options()
    {
        return $this->hasMany(Option::class);
    }
    
    public function comments()
    {
        return $this->hasMany(Comment::class);
    }
    
    // متدهای کمکی
    public function getTotalVotes()
    {
        return Vote::whereIn('option_id', $this->options->pluck('id'))->count();
    }
    
    public function getDetailedVoteStats()
    {
        // محاسبه آمار تفصیلی آرا
    }
}
```

### 3.3 پیاده‌سازی کنترلرها

#### کنترلر ElectionController
```php
// app/Http/Controllers/Admin/ElectionController.php
class ElectionController extends Controller
{
    public function index(Request $request)
    {
        // نمایش لیست نظرسنجی‌ها با امکان فیلتر و جستجو
    }
    
    public function create()
    {
        // نمایش فرم ایجاد نظرسنجی جدید
    }
    
    public function store(Request $request)
    {
        // ذخیره نظرسنجی جدید
    }
    
    public function export(Request $request)
    {
        // صادرات داده‌های نظرسنجی به فرمت Excel
    }
}
```

#### کنترلر UserController
```php
// app/Http/Controllers/Admin/UserController.php
class UserController extends Controller
{
    public function index(Request $request)
    {
        // نمایش لیست کاربران با امکان فیلتر و جستجو
    }
    
    public function edit(User $user)
    {
        // نمایش فرم ویرایش کاربر
    }
    
    public function update(Request $request, User $user)
    {
        // بروزرسانی اطلاعات کاربر
    }
}
```

### 3.4 پیاده‌سازی صادرات Excel

#### کلاس AdminElectionExport
```php
// app/Exports/AdminElectionExport.php
class AdminElectionExport implements FromCollection, WithHeadings, WithMapping, ShouldAutoSize, WithStyles, WithEvents
{
    protected $elections;
    
    public function __construct($elections = null)
    {
        $this->elections = $elections ?: Election::with(['user', 'options'])->get();
    }
    
    public function collection()
    {
        return $this->elections;
    }
    
    public function headings(): array
    {
        return [
            'شناسه',
            'عنوان',
            'توضیحات',
            'وضعیت',
            'نوع نظرسنجی',
            'تعداد شرکت‌کنندگان',
            'تعداد آرا',
            'تعداد گزینه‌ها',
            'تعداد نظرات',
            'تاریخ پایان',
            'تاریخ ایجاد',
            'ایجاد کننده'
        ];
    }
    
    public function registerEvents(): array
    {
        return [
            AfterSheet::class => function(AfterSheet $event) {
                // تنظیمات RTL و فونت فارسی
                $event->sheet->getDelegate()->setRightToLeft(true);
                
                // سایر تنظیمات استایل و قالب‌بندی
            },
        ];
    }
}
```

### 3.5 پیاده‌سازی سیستم اشتراک

#### مدل SubscriptionTier
```php
// app/Models/SubscriptionTier.php
class SubscriptionTier extends Model
{
    public function subFeatures()
    {
        return $this->belongsToMany(SubFeature::class);
    }
    
    public function subscriptionUsers()
    {
        return $this->hasMany(SubscriptionUser::class);
    }
}
```

#### کنترلر SubscriptionUserController
```php
// app/Http/Controllers/Admin/SubscriptionUserController.php
class SubscriptionUserController extends Controller
{
    public function store(Request $request)
    {
        // ایجاد اشتراک جدید برای کاربر
        $data = $request->validate([
            'user_id' => ['required', 'exists:users,id'],
            'subscription_tier_id' => ['required', 'exists:subscription_tiers,id'],
            'status' => ['required', 'in:active,inactive,pending,cancelled'],
            'duration' => ['required', 'integer', 'min:1'],
            'duration_unit' => ['required', 'in:days,months,years'],
        ]);
        
        // محاسبه تاریخ شروع و پایان اشتراک
        $startsAt = Carbon::now();
        $endsAt = null;
        
        if ($data['duration_unit'] === 'days') {
            $endsAt = $startsAt->copy()->addDays(intval($data['duration']));
        } elseif ($data['duration_unit'] === 'months') {
            $endsAt = $startsAt->copy()->addMonths(intval($data['duration']));
        } elseif ($data['duration_unit'] === 'years') {
            $endsAt = $startsAt->copy()->addYears(intval($data['duration']));
        }
        
        // ایجاد رکورد اشتراک
        SubscriptionUser::create([
            'user_id' => $data['user_id'],
            'subscription_tier_id' => $data['subscription_tier_id'],
            'status' => $data['status'],
            'starts_at' => $startsAt,
            'ends_at' => $endsAt,
        ]);
    }
}
```

## فصل چهارم: اپراتوری سیستم

### 4.1 داشبورد مدیریت

داشبورد مدیریت سیستم نظرینو امکان دسترسی به تمام بخش‌های مدیریتی را فراهم می‌کند. این داشبورد شامل منوهای زیر است:
- مدیریت کاربران
- مدیریت نظرسنجی‌ها
- مدیریت نقش‌ها و دسترسی‌ها
- مدیریت اشتراک‌ها
- گزارش‌گیری و آمار

![داشبورد مدیریت](images/admin-dashboard.png)

### 4.2 مدیریت کاربران

در این بخش، مدیر سیستم می‌تواند کاربران را مدیریت کند، اطلاعات آن‌ها را ویرایش کند، و نقش‌های مختلف را به آن‌ها اختصاص دهد.

![لیست کاربران](images/users-list.png)

برای ایجاد کاربر جدید، از فرم زیر استفاده می‌شود:

![ایجاد کاربر جدید](images/user-create.png)

### 4.3 مدیریت نظرسنجی‌ها

در این بخش، مدیر سیستم می‌تواند تمام نظرسنجی‌های موجود در سیستم را مشاهده و مدیریت کند.

![لیست نظرسنجی‌ها](images/elections-list.png)

برای مشاهده جزئیات یک نظرسنجی و نتایج آن:

![جزئیات نظرسنجی](images/election-details.png)

### 4.4 صادرات داده‌ها

سیستم امکان صادرات داده‌ها در قالب Excel را فراهم می‌کند. برای این کار، کافی است روی دکمه "خروجی اکسل" در صفحات مختلف کلیک کنید.

![صادرات داده‌ها](images/export-excel.png)

نمونه خروجی Excel برای نظرسنجی‌ها:

![نمونه خروجی Excel](images/excel-output.png)

### 4.5 مدیریت اشتراک‌ها

در این بخش، مدیر سیستم می‌تواند سطوح مختلف اشتراک و کاربران اشتراکی را مدیریت کند.

![لیست سطوح اشتراک](images/subscription-tiers.png)

![لیست کاربران اشتراکی](images/subscription-users.png)

## فصل پنجم: نتایج و پیشنهادات

### 5.1 نتایج پروژه

سیستم نظرینو با موفقیت پیاده‌سازی شده است و قابلیت‌های زیر را ارائه می‌دهد:
- مدیریت کامل کاربران، نقش‌ها و دسترسی‌ها
- ایجاد و مدیریت نظرسنجی‌های عمومی و خصوصی
- سیستم رأی‌گیری امن و قابل اعتماد
- مدیریت اشتراک‌ها و سطوح دسترسی
- صادرات داده‌ها در قالب Excel با پشتیبانی کامل از زبان فارسی
- تحلیل هوشمند نتایج نظرسنجی‌ها

### 5.2 پیشنهادات برای توسعه آینده

برای توسعه و بهبود سیستم در آینده، پیشنهادات زیر ارائه می‌شود:

1. **افزودن قابلیت‌های تحلیل پیشرفته‌تر**:
   - استفاده از الگوریتم‌های یادگیری ماشین برای تحلیل عمیق‌تر نتایج
   - ارائه نمودارهای تعاملی و داشبوردهای تحلیلی پیشرفته

2. **بهبود امنیت سیستم**:
   - پیاده‌سازی احراز هویت دو مرحله‌ای
   - افزودن سیستم تشخیص و جلوگیری از تقلب در رأی‌گیری

3. **توسعه API**:
   - ایجاد API کامل برای استفاده در اپلیکیشن‌های موبایل
   - امکان ادغام با سایر سیستم‌ها

4. **بهبود تجربه کاربری**:
   - طراحی رابط کاربری واکنش‌گرا برای استفاده بهتر در دستگاه‌های مختلف
   - افزودن قابلیت‌های شخصی‌سازی بیشتر برای کاربران

5. **گسترش قابلیت‌های صادرات و واردات داده**:
   - پشتیبانی از فرمت‌های بیشتر مانند CSV، PDF و JSON
   - امکان وارد کردن داده از منابع خارجی

## منابع

1. Laravel Documentation. (2023). https://laravel.com/docs
2. PhpSpreadsheet Documentation. (2023). https://phpspreadsheet.readthedocs.io/
3. Maatwebsite/Laravel-Excel. (2023). https://docs.laravel-excel.com/
4. Bootstrap Documentation. (2023). https://getbootstrap.com/docs/
5. Vazir Font. (2023). https://github.com/rastikerdar/vazir-font
6. Verta - Persian DateTime. (2023). https://github.com/hekmatinasser/verta

## پیوست‌ها

### پیوست الف: نمودار ERD کامل سیستم

![نمودار ERD](images/erd-diagram.png)

### پیوست ب: نمودار DFD سطح 0

![نمودار DFD سطح 0](images/dfd-level0.png)

### پیوست ج: نمودار DFD سطح 1 (مدیریت نظرسنجی‌ها)

![نمودار DFD سطح 1](images/dfd-level1-elections.png)
